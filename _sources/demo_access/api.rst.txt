Interacting with the DeepHub API
++++++++++++++++++++++++++++++++

An OpenID server is required in order to enable authorization features in the DeepHub. To achieve this, Keycloak is used for identity and access management. Keycloak is an open-source product (Apache license 2.0) with strong backing from Red Hat.

To interact with the trial version of the DeepHub API, you need to consider the following:

1) For a request to the DeepHub APIs, an access token must be generated by this service.


2) To get the token, send a POST message to: 

   *https://auth.flowcate.io/realms/omlox/protocol/openid-connect/token* 

   that contains the following X-WWW-FORM-URLENCODED encoded content in the body:

       - grant_type: "client_credentials"
       - client_id:  "deephub-test-client"
       - username:   <the username we sent you>
       - password:   <your newly-created password>

3) Example with cURL:

.. code-block:: shell

    curl -L -X POST 'https://auth.flowcate.io/realms/omlox/protocol/openid-connect/token' 
    -H 'Content-Type:application/x-www-form-urlencoded' 
    --data-urlencode 'grant_type=client_credentials' 
    --data-urlencode 'scope=openid' 
    --data-urlencode 'client_id=deephub-test-client' 
    --data-urlencode 'client_secret=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'
    --data-urlencode 'user_name=<the username we sent you>'
    --data-urlencode 'password=<your newly-created password>'


4) Use "access_token" from the response for requests made to the DeepHub REST APIs.

.. code-block:: json

    {
        "access_token": "eyJhbGciO.................",
        "expires_in": 900,
        "refresh_expires_in": 0,
        "refresh_token": "eyJhbGciOi..............",
        "token_type": "bearer",
        "id_token": "eyJhbGciOiJSUz................",
        "not-before-policy": 1586429949,
        "session_state": "cfd8804d-1c8d-4a6e-ab7f-af60ae1d362b",
        "scope": "openid demo-test-scope offline_access profile email"
    }

|

.. image:: images/access_token.png

5) The following table highlights important parameters for your DeepHub instance:

.. list-table::
   :widths: 25 35
   :header-rows: 1
   :stub-columns: 1

   * -
     - **Parameters**
   * - **Access Token URL**
     - https://auth.flowcate.io/realms/omlox/protocol/openid-connect/token
   * - **Client ID**
     - deephub-test-client
   * - **Client Secret**
     - xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
   * - **Base URL**
     - https://<your company name>.trialinstances.flowcate.io
   * - **WebSocket API**
     - wss://<your company name>.trialinstances.flowcate.io/v1/ws/socket
   * - **REST API**
     - https://<your company name>.trialinstances.flowcate.io/v1
   * - **DeepHub UI**
     - https://<your company name>.trialinstances.flowcate.io/ui