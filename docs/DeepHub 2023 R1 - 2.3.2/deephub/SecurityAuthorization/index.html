<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-DeepHub 2023 R1 - 2.3.2 plugin-docs plugin-id-default docs-doc-id-deephub/SecurityAuthorization">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Security &amp; Authorization | DeepHub®</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.deephub.io/img/deephub_dots_logo.png"><meta data-rh="true" name="twitter:image" content="https://docs.deephub.io/img/deephub_dots_logo.png"><meta data-rh="true" property="og:url" content="https://docs.deephub.io/docs/DeepHub 2023 R1 - 2.3.2/deephub/SecurityAuthorization"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="DeepHub 2023 R1 - 2.3.2"><meta data-rh="true" name="docusaurus_tag" content="docs-default-DeepHub 2023 R1 - 2.3.2"><meta data-rh="true" name="docsearch:version" content="DeepHub 2023 R1 - 2.3.2"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-DeepHub 2023 R1 - 2.3.2"><meta data-rh="true" property="og:title" content="Security &amp; Authorization | DeepHub®"><meta data-rh="true" name="description" content="DeepHub® uses the OpenID standard to secure access to the API."><meta data-rh="true" property="og:description" content="DeepHub® uses the OpenID standard to secure access to the API."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.deephub.io/docs/DeepHub 2023 R1 - 2.3.2/deephub/SecurityAuthorization"><link data-rh="true" rel="alternate" href="https://docs.deephub.io/docs/DeepHub 2023 R1 - 2.3.2/deephub/SecurityAuthorization" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.deephub.io/docs/DeepHub 2023 R1 - 2.3.2/deephub/SecurityAuthorization" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DeepHub® RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DeepHub® Atom Feed"><link rel="stylesheet" href="/assets/css/styles.413f9f81.css">
<link rel="preload" href="/assets/js/runtime~main.33e2542e.js" as="script">
<link rel="preload" href="/assets/js/main.8315d4ff.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DeepHub®" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="DeepHub®" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/DeepHub 2023 R1 - 2.3.2/overview">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/DeepHub 2023 R1 - 2.3.2/overview">DeepHub 2023 R1 - 2.3.2</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/deephub/SecurityAuthorization">DeepHub 2023 R2 - 2.4.0-beta.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/SecurityAuthorization">DeepHub 2023 R1 - 2.3.2</a></li><li><a class="dropdown__link" href="/docs/DeepHub 2022 R2 - 2.2.3/deephub/SecurityAuthorization">DeepHub 2022 R2 - 2.2.3</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/DeepHub 2023 R1 - 2.3.2/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/DeepHub 2023 R1 - 2.3.2/category/deephub">DeepHub®</a><button aria-label="Toggle the collapsible sidebar category &#x27;DeepHub®&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/ServerConfiguration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/SecurityAuthorization">Security &amp; Authorization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/latency">Latency and Asynchronous Behaviour</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/api">REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/WebsocketAPI">WebSocket API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/LocatingRuleExtension">Locating Rule Extension</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/mobilezones">Mobile Zone Extension</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/ciscocmx">Cisco CMX Location Notification Adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/iso24730">ISO-24730 Adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/RPCInterface">RPC Interface</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/DeepHub 2023 R1 - 2.3.2/category/deephub-ui">DeepHub® UI</a><button aria-label="Toggle the collapsible sidebar category &#x27;DeepHub® UI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/DeepHub 2023 R1 - 2.3.2/category/test-drive-the-deephub">Test-drive the DeepHub®</a><button aria-label="Toggle the collapsible sidebar category &#x27;Test-drive the DeepHub®&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/DeepHub 2023 R1 - 2.3.2/release-note">Changelog</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/DeepHub 2023 R1 - 2.3.2/category/deephub"><span itemprop="name">DeepHub®</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Security &amp; Authorization</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: DeepHub 2023 R1 - 2.3.2</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Security &amp; Authorization</h1><section class="section markdown"><p>DeepHub® uses the OpenID standard to secure access to the API.
This document describes how to apply permission settings to individual API endpoints and OpenID users, and provides an example OpenID setup using Keycloak as OpenID server.
Though any standard OpenID server can be used.
Also refer to the Server Configuration readme for OpenID configuration options. </p></section><section class="section markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-authorization">Enable Authorization<a href="#enable-authorization" class="hash-link" aria-label="Direct link to Enable Authorization" title="Direct link to Enable Authorization">​</a></h2><p>In order to enable authorization features permissions, OpenID and server configurations need to be configured accordingly.
The following gives a quick overview about files and configuration options which need to be configured to enable authorization and security features:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="base-configuration">Base Configuration<a href="#base-configuration" class="hash-link" aria-label="Direct link to Base Configuration" title="Direct link to Base Configuration">​</a></h3><p>The base configuration can be done in the hub_config.yaml configuration file, via environment variables, or via command line arguments. See the <a href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/ServerConfiguration">&quot;Configuration&quot;</a> section for a general overview
of the different base configuration possibilities.</p><ul><li><strong>require_authorization</strong> must be set to true</li><li><strong>openid_client_name</strong> must be set to verify audiences. This is mandatory by OpenID, see also the audience claim setup example below.</li><li><strong>verify_authserver</strong> set to true when running the server in production mode (requires authserver_public_key_path). </li><li><strong>authserver_public_key_path</strong> should point to the public key of the OpenID server when running in production mode</li><li><strong>force_https</strong> should be set to true in production mode to disable any insecure plain http or websocket communication</li><li><strong>openid_config_url</strong> must be set to the standard OpenID configuration endpoint, e.g.  </li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">openid_config_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/auth/realms/omlox/.well</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">known/openid</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">configuration</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="server-certificates">Server certificates<a href="#server-certificates" class="hash-link" aria-label="Direct link to Server certificates" title="Direct link to Server certificates">​</a></h3><p>When running the server in production mode, appropriate settings such as server certificates, public_key_path, private_key_path and dh_params_path must be set.
Please refer to the <a href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/ServerConfiguration#server-configuration">&quot;Configuration&quot;</a> section for details..</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="authorization-flow-type">Authorization Flow Type<a href="#authorization-flow-type" class="hash-link" aria-label="Direct link to Authorization Flow Type" title="Direct link to Authorization Flow Type">​</a></h3><p>DeepHub uses Bearer Authorization for the REST API.
Clients connecting to the DeepHub will never send passwords directly to the hub.
Instead clients login to the OpenID server and provide the bearer token with each request header to the Hub.
The DeepHub is able to securely verify the token is valid and was issued by the configured OpenID server. </p><p>For service-to-service and client-to-service communication we advise to use bearer authorization.
For web clients we advise to use Authorization Code Flow for secure login.
An Angular web client example is located in the examples/angular-oidc-sample-code-flow folder.   </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dedicated-permissions">Dedicated Permissions<a href="#dedicated-permissions" class="hash-link" aria-label="Direct link to Dedicated Permissions" title="Direct link to Dedicated Permissions">​</a></h3><p>The dedicated permissions can be configured within the permissions.yaml configuration file.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>There is no other way to configure the permissions than via this file. Environment variables or command line arguments to configure these are not available.</p></div></div><p>This file contains the configuration of the authorization to access the REST API and the WebSocket API. It is explained in detail in the <a href="#applying-individual-rest-api-permissions">next section</a>, directly below: </p></section><section class="section markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="applying-individual-rest-api-permissions">Applying individual REST API Permissions<a href="#applying-individual-rest-api-permissions" class="hash-link" aria-label="Direct link to Applying individual REST API Permissions" title="Direct link to Applying individual REST API Permissions">​</a></h2><p>DeepHub server uses an RBAC (Role Based Access Control) model to assign permissions to OpenID roles. The permissions are stored in a YAML based file in the data directory of the Docker container. The permissions are loaded once at startup.  </p><p>General structure of the permissions file:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">role-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Some role description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&#x27;/api/path&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PERMISSION1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PERMISSION2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&#x27;/api/path_2/*&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PERMISSION1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&#x27;/api/path_3/:resource_id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PERMISSION1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Description of the core elements:</p><ul><li><p><code>role-name</code> must match an actual OpenID role name provided as part of the JWT Access Token. </p></li><li><p><code>/api/path</code> must match an actual DeepHub API endpoint (refer to the OpenAPI file for a list of available endpoints).</p></li><li><p>The <code>*</code> symbol is a wildcard, allowing to give permissions to all subpaths of an API, e.g. <code>/api/path_2/*</code> will match all subpaths like <code>/api/path_2/a</code>, <code>/api/path_2/b</code> etc. </p></li><li><p>A path for a given role should only be specified once. Duplicates will produce an error.</p></li><li><p><code>Permission</code> can be any of the following (multiple entries possible): <code>CREATE_ANY</code>, <code>READ_ANY</code>. <code>UPDATE_ANY</code>, <code>DELETE_ANY</code>, <code>CREATE_OWN</code>, <code>READ_OWN</code>, <code>UPDATE_OWN</code>, <code>DELETE_OWN</code>.
Note that the respective <code>ANY</code> and <code>OWN</code> permissions are mutually exclusive, i.e., for a given path a role can have either <code>READ_ANY</code> or <code>READ_OWN</code>, but not both.
Refer to the description below to choose the right permission.</p></li><li><p><code>:resource_id</code> is a placeholder variable, matching identifiers given as part of a request.
For example, the permission URL <code>/v1/providers/:provider_id/location</code> will match the HTTP GET request to <code>/v1/providers/provider123/location</code>, and map the placeholder variable <code>provider_id</code> to the value &quot;provider123&quot;.
When the permission for the URL is one of <code>CREATE_OWN</code>, <code>READ_OWN</code>, <code>UPDATE_OWN</code>, <code>DELETE_OWN</code> then the client is required to provide ownership proof with his access token.
The structure of the required access token is described <a href="#access-token-extension-for-ownership-claims">below</a>.<br>
<strong>Important:</strong> The placeholder variables <strong>must</strong> match the names defined in the OpenAPI specification, e.g. it&#x27;s required to use <code>:provider_id</code> for the route <code>/v1/providers/:provider_id</code>.
The placeholder variable&#x27;s name is used to match named resource identifiers provided with the access token, thus a mismatch will result in failed authorization. </p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="permission-types">Permission types<a href="#permission-types" class="hash-link" aria-label="Direct link to Permission types" title="Direct link to Permission types">​</a></h3><p><code>CREATE_ANY</code><br>
<!-- -->The role is allowed to create (e.g. via POST request) a resource at the given API path.</p><p><code>READ_ANY</code><br>
<!-- -->The role is allowed to read all resource objects at a given API path.</p><p><code>UPDATE_ANY</code><br>
<!-- -->The role is allowed to update (e.g. via PUT request) resources at given API path. </p><p><code>DELETE_ANY</code><br>
<!-- -->The role is allowed to delete all resources for a given API path.</p><p><code>CREATE_OWN</code>, <code>READ_OWN</code>, <code>UPDATE_OWN</code>, <code>DELETE_OWN</code><br>
<!-- -->The role is only allowed to read or mutate it&#x27;s own resources.
Resource ownership is defined via JWT AccessToken.
A particular user which owns a resource must have a matching resource UUID in the Access Token. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="permissions-example">Permissions example<a href="#permissions-example" class="hash-link" aria-label="Direct link to Permissions example" title="Direct link to Permissions example">​</a></h3><p>In the example below a role named omlox-api-role is provided full admin access to all API endpoints using a wildcard match: </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">omlox-api-role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Super user with all permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&#x27;/v1/*&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> CREATE_ANY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> READ_ANY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> UPDATE_ANY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DELETE_ANY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example a user is given access restricted to his own location data: </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">omlox-api-role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> A user with access to only his own location data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&#x27;/v1/providers/:provider_id/*&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> CREATE_OWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> READ_OWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> UPDATE_OWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DELETE_OWN</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></section><section class="section markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="applying-permissions-to-websocket-topics">Applying Permissions to Websocket Topics<a href="#applying-permissions-to-websocket-topics" class="hash-link" aria-label="Direct link to Applying Permissions to Websocket Topics" title="Direct link to Applying Permissions to Websocket Topics">​</a></h2><p>Permissions to websocket topics follow the same rules as the permissions for the REST API.
The url paths use the following scheme: <code>/v1/ws/socket/topic/:resource_id</code></p><p>In the scheme above, <code>topic</code> is a placeholder for the actual websocket topic name, e.g. &quot;location_updates&quot;, and <code>:resource_id</code> is a placeholder for the identifier name which must match the data for this topic using the same rules and naming scheme as stated for the <a href="#applying-individual-rest-api-permissions">REST API</a>.</p><p>For an example, a permission to access only own location data which matches a provider_id given as part of the access token looks as follows:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">read-only-own-resources-role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&#x27;/v1/ws/socket/location_updates/:provider_id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> CREATE_OWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> READ_OWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> UPDATE_OWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DELETE_OWN</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Wildcards can be applied in the same way as for the REST API, for example <code>/v1/ws/socket/location_updates/*</code> would match location updates for all location providers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-token-extension-for-ownership-claims">Access Token extension for ownership claims<a href="#access-token-extension-for-ownership-claims" class="hash-link" aria-label="Direct link to Access Token extension for ownership claims" title="Direct link to Access Token extension for ownership claims">​</a></h3><p>In order to allow access to ownership restricted URLs the access token must contain an object member named <code>https://deephub.io/owned_resources</code> containing named lists to resource identifiers.
The member names <strong>must</strong> adhere to the following scheme:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">placeholder_variable + &#x27;s&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In other words, the name of the members is the plural of the placeholder variable name. As an example, the json content of an access token looks like this:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;https://deephub.io/owned_resources&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;provider_ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;provider123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;trackable_ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;trackable123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;zone_ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;zone123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fence_ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;fence123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></section><section class="section markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-openid-setup-with-keycloak">Example OpenID setup with Keycloak<a href="#example-openid-setup-with-keycloak" class="hash-link" aria-label="Direct link to Example OpenID setup with Keycloak" title="Direct link to Example OpenID setup with Keycloak">​</a></h2><p>An OpenID server is required in order to enable authorization features in DeepHub.
Below is an example using Keycloak, though the basic setup should work similar for other OpenID servers. </p><p>Prerequisites: A running Keycloak instance. You can start with a simple standalone instance for development and testing.
See the <a href="https://www.keycloak.org/docs/latest/server_admin/index.html" target="_blank" rel="noopener noreferrer">Keycloak guide</a> to get started. Alternatively, you can download and use our <a href="https://github.com/flowcate/deephub-advanced-setup" target="_blank" rel="noopener noreferrer">&quot;deephub-advanced-setup&quot; example from github</a>.</p><p>Log in to the Keycloak Admin Console of your Keycloak instance and then follow this procedure:</p><p>At first we have to create a new realm; let&#x27;s call it &quot;omlox&quot; in this example:</p><ul><li>From the Master drop-down menu, click Add Realm. </li><li>Type omlox in the Name field and click Create.</li></ul><p>Next we create the role &quot;omlox-api-role&quot; for DeepHub API access. To do so:</p><ul><li>From the menu, click Roles to open the roles list.</li><li>Click on Add Role on the right side of the list</li><li>Enter omlox-api-role in the Role Name field. The role name must not be changed, because this role name is mapped to omlox permissions. </li></ul><p>Next we create a user named &quot;omlox-api-user&quot;. To create a new user in the omlox realm, complete the following steps:</p><ul><li>Make sure the omlox Realm is the selected current Realm in the Master drop-down menu</li><li>From the menu, click Users to open the user list page.</li><li>On the right side of the user list, click Add User to open the add user page.</li><li>Enter the name omlox-api-user in the Username field. Flip the Email Verified switch from Off to On and click Save to save the data and open the management page for the new user.</li><li>Click the Credentials tab and enter a password for the new user. Flip the Temporary switch to Off to make the new password permanent. Click Set Password to save the changes.</li><li>Click the Role Mappings tab. In the Realm Roles list, select omlox-api-role and click the Add selected button.</li></ul><p>Next we create a client named &quot;omlox-api-client&quot;.  To create a new user in the omlox realm, complete the following steps:</p><ul><li>Make sure the omlox realm is the selected current realm in the Master drop-down menu</li><li>From the menu, click Clients to open the client list page.</li><li>On the right side of the client list, click Create to open the create client page.</li><li>Enter the name omlox-api-client in the Client ID field. Select openid-connect in the Client Protocol dropdown.</li><li>Select Public as Access Type</li><li>Toggle Service Accounts Enabled. This enables Client Credentials Grant workflow for the DeepHub to fetch access tokens for token verification of client requests. </li><li>Click Save.</li></ul><p>Next, create another client to be used by the DeepHub service itself. Note: This client is mandatory even in case no other OpenID exists to communicate with the DeepHub,
and the client name must match with the openid_client_name in the DeepHub configuration.
All other OpenID clients which communicate with the DeepHub have to include this client in the JWT as audience, so that the DeepHub can verify audiences as mandated by OpenID. </p><ul><li>Repeat the previous step to create a client.</li><li>Name deephub-service. Note: The name is case-sensitive and must match the one in the configuration file.</li><li>Set the Access Type to bearer-only.</li><li>Click Save.</li></ul><p>For security reasons an OpenID enabled service has to verify audience claims in order to avoid token misuse. Follow these steps:</p><ul><li>From the meu, click Client Scopes to open the client scopes list.</li><li>Click Create to create a new client scope.</li><li>Enter hub-service into the Name field.</li><li>Click the Save button to create the new client scope.</li><li>In the list of client scopes, select the newly created hub-service.</li><li>Select Mappers from the top menu.</li><li>Click the Create button on the right side.</li><li>Enter hub-service-audience into the Name field.</li><li>From the Mapper Type selection choose Audience.</li><li>In the Included Client Audience select deephub-service.</li><li>Click Save button to save the changes.</li><li>Now we create a mapping between the newly created scope and the client used for user logins. From the left menu panel, choose Clients and choose omlox-api-client.</li><li>From either the Default Client Scopes or Optional Client Scopes list select hub-service and click on Add selected. You can only add it to either default or optional. The difference is that when you add it to the default list the token will always contain the audience hub-service. When you set it to optional the user client (e.g. web application) must explicitly set the scope to hub-service when requesting the token, the token will then contain the audience deephub-service. It’s advised to use the optional mapper and limit scopes appropriately on the user client side.  </li></ul><p>Optional steps
It’s possible to define fine-grained ownership permissions by adding custom attributes to a user. This allows for assigning read_own permissions to API paths which are restricted to users that own a particular resource. Follow these steps:</p><ul><li>From the left menu, click Clients.</li><li>From the clients list, select omlox-api-client. From the top menu select Mappers.</li><li>Click on the Create button to create a new mapper.</li><li>Set a name like Assigned Location Providers.</li><li>In the Mapper Type selection, select User Attribute.</li><li>In the User Attribute field, set <code>https://deephub.io/owned_resources/provider_ids</code> (Important: This field must match with the one we set in the User attributes for the particular user.</li><li>In the Token Claim Name field, set <code>https://deephub\.io/owned_resources.provider_ids</code> (without quotes). It’s important to use this exact name, as the DeepHub will check if a user has access to particular resources using this name. Also note the <code>\</code> and <code>.</code> in this name. This will actually create a json member named <code>https://deephub.io/owned_resources</code> with an object named <code>provider_ids</code>.</li><li>From the Claim JSON Type selection, select String.</li><li>Enable Multivalued.</li><li>Click Save</li></ul><p>Repeat the above steps to create respective mappers for fences, trackables and zones as well, using the following values. </p><p>For fence ownership mapping:</p><ul><li>Set User Attribute to: <code>https://deephub.io/owned_resources/fence_ids</code></li><li>Set Token Claim Name to: <code>https://deephub\.io/owned_resources.fence_ids</code></li></ul><p>For trackable ownership mapping:</p><ul><li>Set User Attribute to: <code>https://deephub.io/owned_resources/trackable_ids</code></li><li>Set Token Claim Name to: <code>https://deephub\.io/owned_resources.trackable_ids</code></li></ul><p>For zone ownership mapping:</p><ul><li>Set User Attribute to: <code>https://deephub.io/owned_resources/zone_ids</code></li><li>Set Token Claim Name to: <code>https://deephub\.io/owned_resources.zone_ids</code></li></ul><p>For source ownership mapping:</p><ul><li>Set User Attribute to: <code>https://deephub.io/owned_resources/source_ids</code></li><li>Set Token Claim Name to: <code>https://deephub\.io/owned_resources.source_ids</code></li></ul><p>Now we can create actual user attributes which will then be mapped at runtime. To assign a Location Provider to a user, follow these steps:</p><ul><li>In the left menu bar, click Users</li><li>Choose a user from the list to whom you want to assign a trackable</li><li>Click Attributes.</li><li>In the attributes key / value list, set key to <code>https://deephub.io/owned_resources/provider_ids</code> and the value to the ID of the Location Provider you want to assign to the user (e.g. 5896823C-3B3F-48BB-B74B-E43041ABD59C).</li></ul><p>Repeat the above steps for fences, trackables, zones, and sources using the respective keys below:</p><ul><li><code>https://deephub.io/owned_resources/fence_ids</code></li><li><code>https://deephub.io/owned_resources/trackable_ids</code></li><li><code>https://deephub.io/owned_resources/zone_ids</code></li><li><code>https://deephub.io/owned_resources/source_ids</code></li></ul><p>Note: You can set multiple entries in the value field using &quot;##&quot; as delimiter between entries. For example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">providerid1##providerid2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will show as two items in the provider_ids array.</p><p>Further note: source_ids refer to the source given in a location update. This source can reference a zone, but doesn&#x27;t have to. As such, source_ids should contain all zone ids in addition to other source ids. At this point some double book keeping is required.</p></section></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/ServerConfiguration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configuration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DeepHub 2023 R1 - 2.3.2/deephub/latency"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Latency and Asynchronous Behaviour</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enable-authorization" class="table-of-contents__link toc-highlight">Enable Authorization</a><ul><li><a href="#base-configuration" class="table-of-contents__link toc-highlight">Base Configuration</a></li><li><a href="#server-certificates" class="table-of-contents__link toc-highlight">Server certificates</a></li><li><a href="#authorization-flow-type" class="table-of-contents__link toc-highlight">Authorization Flow Type</a></li><li><a href="#dedicated-permissions" class="table-of-contents__link toc-highlight">Dedicated Permissions</a></li></ul></li><li><a href="#applying-individual-rest-api-permissions" class="table-of-contents__link toc-highlight">Applying individual REST API Permissions</a><ul><li><a href="#permission-types" class="table-of-contents__link toc-highlight">Permission types</a></li><li><a href="#permissions-example" class="table-of-contents__link toc-highlight">Permissions example</a></li></ul></li><li><a href="#applying-permissions-to-websocket-topics" class="table-of-contents__link toc-highlight">Applying Permissions to Websocket Topics</a><ul><li><a href="#access-token-extension-for-ownership-claims" class="table-of-contents__link toc-highlight">Access Token extension for ownership claims</a></li></ul></li><li><a href="#example-openid-setup-with-keycloak" class="table-of-contents__link toc-highlight">Example OpenID setup with Keycloak</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Flowcate.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.33e2542e.js"></script>
<script src="/assets/js/main.8315d4ff.js"></script>
</body>
</html>