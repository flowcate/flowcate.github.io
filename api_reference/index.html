

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DeepHub® API &#8212; DeepHub® 2022 R1  documentation</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/hub.css" />
    <link rel="stylesheet" type="text/css" href="../_static/root.css" />
    <link rel="stylesheet" type="text/css" href="../_static/header.css" />
    <link rel="stylesheet" type="text/css" href="../_static/index-site.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="REST API" href="restApi.html" />
    <link rel="prev" title="Overview" href="../overview/index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">DeepHub® 2022 R1</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../overview/index.html">
  Overview
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  DeepHub® API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../ui/index.html">
  DeepHub® UI
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../demo_access/index.html">
  Accessing Trial Instances
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation_instructions/index.html">
  Running the DeepHub® Locally
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <div class="col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>
            
          

          
    <div class="d-none d-xl-block col-xl-2 bd-toc"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
        
          
          <div class="toc-item">
            
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#latency-and-asynchronous-behaviour">
   Latency and Asynchronous Behaviour
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rest-api">
   REST API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#websocket">
   WebSocket
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mobile-zone-extension">
   Mobile Zone Extension
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup-and-configuration">
     Setup and Configuration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cisco-cmx-location-notification-adapter">
   Cisco CMX Location Notification Adapter
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Setup and Configuration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iso-24730-adapter">
   ISO-24730 Adapter
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Setup and Configuration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rpc-interface">
   RPC Interface
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-message-flow">
     Example Message Flow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changelog">
   Changelog
  </a>
 </li>
</ul>

</nav>
          </div>
          
          <div class="toc-item">
            
          </div>
          
        
    </div>


          
    

    
        
    

    <main class="col-12 col-md-12 col-xl-10 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
        
        <div>
        
  <div class="section" id="deephub-api">
<span id="api-reference"></span><h1>DeepHub® API</h1>
<div class="section" id="introduction">
<span id="api-reference-introduction"></span><h2>Introduction</h2>
<p>The DeepHub® offers a reference implementation of an omlox™ hub, including a REST API and a WebSocket API. This chapter focuses on these APIs and includes an overview and description of DeepHub specifics.</p>
</div>
<div class="section" id="latency-and-asynchronous-behaviour">
<span id="api-reference-asynchronous-behaviour"></span><h2>Latency and Asynchronous Behaviour</h2>
<p>The DeepHub® is a single process application that is optimized for high throughput and low memory footprint thus being capable of processing huge amounts of requests per second
even on low-end hardware like a Rasperry PI or a NUC PC on the edge.</p>
<p>It provides several I/O APIs that are typically utilized simultaneously by 3rd party services, providing location data towards the DeepHub to be processed on one hand and
events being generated by the DeepHub and published to potential subscribers on the other hand.</p>
<p>It is an event bus at the heart of the DeepHub that makes the processing of the many I/O channels possible and that is responsible for the low overall latency of a single instance installation.
Due to this architecture, the DeepHub acts asynchronously in the sense that delivered input data, e.g. via the REST API, does not synchronously deliver e.g. events via the output WebSocket API.
This is e.g. noticable in case a location update is provided as input but a configured mobile zone (see <a class="reference internal" href="#api-reference-mobilezones"><span class="std std-ref">Mobile Zone Extension</span></a> below) is updated only within some milliseconds.</p>
<p>Future versions of the DeepHub will support the deployment of several hubs to work together as a system for redundancy and availability reasons. In that configuration, it is again the event bus of the several instances that makes collaboration
possible and allows for plugging them together via an external message queue. The overall system latency is then of course influenced by the network latency as well as the latency of the
message queueing application itself.</p>
</div>
<div class="section" id="rest-api">
<h2>REST API</h2>
<p><a class="reference internal" href="restApi.html#deep-hub-api-rest-api"><span class="std std-ref">REST API</span></a></p>
</div>
<div class="section" id="websocket">
<h2>WebSocket</h2>
<p><a class="reference internal" href="websocketApi.html#deep-hub-api-websocket"><span class="std std-ref">WebSocket</span></a></p>
</div>
<div class="section" id="mobile-zone-extension">
<span id="api-reference-mobilezones"></span><h2>Mobile Zone Extension</h2>
<p>The Mobile Zone Extension (MZE) of the DeepHub® allows for the seamless integration of proximity-based positioning solutions that change their position. The MZE changes the position of your proximity zone by connecting the zone with location updates of a real-time locating system - via an omlox Location Provider or an omlox Trackable.</p>
<p>As an example use case, consider you have assets equipped with RFID tags, and you want to keep track of the exact location of your assets in your warehouse. The RFID tags do not provide exact location information. However, with omlox, you can combine multiple positioning technologies and thereby add location information. For example, you could combine an UWB positioning system with proximity information provided by an RFID positioning system.</p>
<p>To illustrate this further, consider you have a forklift equipped with an RFID scanner and an UWB tag. The UWB tag provides exact real-time location information about the forklift, while the RFID scanner provides information about the assets the forklift is carrying. The RFID scanner will receive proximity information as long as your forklift carries assets with RFID tags attached to them.</p>
<p>Normally, the position of a proximity-based zone has to be updated manually, because it cannot generate location information on its own. However, with the DeepHub MZE, you can keep track of the position where assets were dropped off by matching the location information of the forklift with the last-received proximity information of carried assets.</p>
<p>The DeepHub MZE makes this task as simple as possible.</p>
<div class="section" id="setup-and-configuration">
<h3>Setup and Configuration</h3>
<p>Setting up the MZE is done in two steps. First, a zone needs to be created representing each available proximity positioning system (e.g. RFID scanner). Next, an omlox trackable (e.g. representing a forklift) or an omlox location provider (e.g. an UWB tag) needs to be assigned to the zone in order to enable the MZE. By linking the trackable or location provider with the zone of the installed proximity system, the position of the proximity system will be updated in real-time as the trackable or location provider relocates.</p>
<p><strong>Setting up a proximity zone in the DeepHub:</strong></p>
<p>You may create a zone through the DeepHub API or the DeepHub UI. To do so in the UI:</p>
<ul class="simple">
<li><p>Login to the DeepHub UI.</p></li>
<li><p>Choose Zones.</p></li>
<li><p>Create a new zone by setting a proper zone type (rfid or ibeacon) and floor level. You do not need to choose an exact position on the map, as the position will be updated automatically. Simply choose a nearby location.</p></li>
<li><p>Set a unique Foreign ID, for example “forklift-123-rfid”.</p></li>
<li><p>Click Save to create the zone.</p></li>
</ul>
<p>You should now see location updates in real-time in the Live View of the DeepHub UI when location updates are received.</p>
<p>In order to enable the MZE for this zone, you must assign a location provider or trackable to the zone by adding a location provider or trackable to the zone’s properties. This is currently only possible through the DeepHub API. The member variables available for the zone properties are the following:</p>
<ul class="simple">
<li><p>“com.hdm.hub.zone.autozoneupdate.trackables”: A list containing IDs of trackables. The zone’s position is updated whenever a trackable’s location is updated.</p></li>
<li><p>“com.hdm.hub.zone.autozoneupdate.providers”: A list containing IDs of location providers. The zone’s position is updated whenever one of the locations is updated.</p></li>
</ul>
<p>An example zone with location providers and trackables configured for auto position updating of the zone:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ffffffff-bce8-6c23-e342-80bd5c938775&quot;</span><span class="p">,</span>
  <span class="nt">&quot;foreign_id&quot;</span><span class="p">:</span> <span class="s2">&quot;rfid-provider-autozone&quot;</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rfid&quot;</span><span class="p">,</span>
  <span class="nt">&quot;floor&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="nt">&quot;need_transformation&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Zone R (RFID)&quot;</span><span class="p">,</span>
  <span class="nt">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
    <span class="nt">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">0</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">&quot;radius&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
  <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;com.hdm.hub.zone.autozoneupdate.providers&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;autozone-provider-123&quot;</span>
      <span class="p">],</span>
      <span class="nt">&quot;com.hdm.hub.zone.autozoneupdate.trackables&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;5EE9265B-EFDF-4EDB-98AD-9D01E11B687F&quot;</span>
      <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cisco-cmx-location-notification-adapter">
<h2>Cisco CMX Location Notification Adapter</h2>
<p>The Cisco CMX Location Notification Adapter enables the DeepHub® to be integrated with existing Cisco infrastructure, without the need for an additional middleware.</p>
<p>The DeepHub REST API endpoint /adapters/cisco/locations can be configured as a webhook in the Cisco CMX settings. The DeepHub supports version 10.6+ of Cisco CMX.</p>
<div class="section" id="id1">
<h3>Setup and Configuration</h3>
<p>Setting up the Cisco CMX adapter is done by first defining a webhook in the Cisco CMX settings. If the Cisco infrastructure is set up to provide GPS location data, this is the only configuration step.</p>
<p>If the Cisco infrastructure is set up to only send local coordinates, a zone configuration in the DeepHub is required to match the Cisco floor plan. This allows for the translation of incoming location data to projections supported by the DeepHub.</p>
<p><strong>Setting up a Notification Webhook in Cisco CMX for the DeepHub:</strong></p>
<p>You may create a new webhook through the Cisco CMX configuration page. To do so in the UI:</p>
<ol class="arabic simple">
<li><p>Login to Cisco CMX</p></li>
<li><p>Choose Manage → Notifications</p></li>
<li><p>Create a new notification and enter the host and port to your DeepHub instance and enter the URL /v1/adapters/cisco/locations</p></li>
<li><p>Save changes and exit</p></li>
</ol>
<p>If your Cisco infrastructure is set up to only deliver local coordinates, you need to perform these additional steps:</p>
<ol class="arabic simple">
<li><p>Login to the DeepHub UI</p></li>
<li><p>Choose Zone Setup</p></li>
<li><p>Click to create a new zone</p></li>
<li><p>Select wifi as the zone type</p></li>
<li><p>Draw the zone using the drawing tool, or any of the available zone creation tools. The zone shape and location should match the location hierarchy (map) as defined in your Cisco CMX.</p></li>
<li><p>Enter the floor level for the zone and the address (optional).</p></li>
<li><p>In the Foreign ID field, enter the CMX location hierarchy name for this map. For example, “Mathematikon&gt;Berliner Str. 41&gt;5. OG komplett [f.4]”. Note: This field is used to link incoming data from your Cisco CMX with this omlox zone. Therefore, please ensure this field matches the value of your CMX location hierarchy.</p></li>
<li><p>Click save to create and activate the new zone.</p></li>
</ol>
<p>Repeat the steps above for each floor plan in your Cisco CMX for which you want to get location data in the DeepHub.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting up a zone in the DeepHub is optional if Cisco CMX is set up to deliver data in WGS84. Nevertheless, it’s strongly advised to create a zone for each CMX location hierarchy in order to assign correct floor level information to incoming locations from the corresponding CMX location hierarchies. Otherwise, some features that depend on correct floor information, such as geofencing and collision detection, may not behave as expected.</p>
</div>
</div>
</div>
<div class="section" id="iso-24730-adapter">
<h2>ISO-24730 Adapter</h2>
<p>The ISO-24730 Adapter enables the DeepHub® to be integrated with ISO-24730-capable real-time locating systems. The ISO-24730 standard was created in the mid 2000s and revised in 2014. It is supported by
several real-time locating systems e.g. utilizing ultra-wideband technology.</p>
<p>The standard consists of several air interface protocols as well as a single API called “RTLS API”. It is the latter, that the DeepHub supports and that is subject of this configuration documentation.</p>
<div class="section" id="id2">
<h3>Setup and Configuration</h3>
<p>A DeepHub can be configured to work together with several ISO-24739 locating systems at the same time, each one of them being treated as a separate zone.</p>
<p>The DeepHub acts as a client towards a configured ISO-24730 service of an ISO-24730 locating system and therefore requires a separate configuration block consisting of the host, port, type of locating system as well as an identifier for the zone (zone_id or foreign_id) for each of them.</p>
<p><em>Example:</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4000</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">uwb</span>
  <span class="nt">zone_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FDE56BB8-64B1-4B95-ADEB-AB189EE937FE</span>
<span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">otherserver</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4000</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gps</span>
  <span class="nt">foreign_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_id</span>
</pre></div>
</div>
<p>An ISO-24730 configuration can be provided in the same way as other configuration parameters. See the chapter <a class="reference internal" href="../installation_instructions/index.html#deep-hub-install-server-configuration"><span class="std std-ref">Server Configuration</span></a> for details.</p>
</div>
</div>
<div class="section" id="rpc-interface">
<h2>RPC Interface</h2>
<p>The DeepHub® can act as a Remote Procedure Call (RPC) gateway via WebSocket, allowing local devices or services to connect with other devices or services over a local network infrastructure and the internet (which are normally separate from each other and not reachable). This allows for querying of sensor data and device capabilities, or initiating firmware updates as well as other types of information exchange which can be handled via RPC. The DeepHub RPC interface is based on the JSON-RPC exchange format version 2.0 [1].</p>
<p>The image below illustrates the building blocks of the architecture with a simple example data flow:</p>
<a class="reference external image-reference" href="rpc_architecture.png"><img alt="" src="../_images/rpc_architecture.png" /></a>
<p>The endpoint for the DeepHub RPC interface is: <strong>/v1/ws/rpc</strong>.</p>
<p>The general data flow is as follows:</p>
<ol class="arabic simple">
<li><p>A service which provides certain functionality registers itself with the DeepHub and announces that it wants to handle a method. This can be anything from querying sensor data of local tags, managing firmware updates of on-site devices, or remote communication between services. In our example flow, we register for a method named “Blink LED” to control a local LED light.</p></li>
<li><p>A client application (e.g. a web browser in the local network or over the internet) can now send the RPC Request with the method name “Blink LED” with optional parameters. The DeepHub will forward this call with the parameters to all services handling the “Blink LED” request.</p></li>
<li><p>The services which registered themselves for handling “Blink LED” will receive the client request and reply with an RPC response message.</p></li>
<li><p>The DeepHub forwards this response message to the client. By default, only the first response is forwarded and the request is finalized.</p></li>
</ol>
<p>Registering for RPC method handling is done by sending an RPC request containing the method name “register”, the “method” parameter, and a name for the method as values in the parameters of the request. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span>
  <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Blink LED&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The DeepHub defines three optional properties for the JSON-RPC Request structure:</p>
<ul class="simple">
<li><p>stream: When set to true, all responses are continuously forwarded to the client that created the request. The stream will end when the timeout for the request is reached (see timeout description below).</p></li>
<li><p>aggregate: All data is combined into a single response and forwarded to the client that created the request. The aggregated result is delivered after each registered handler sends a response or the timeout is reached - whichever comes first.</p></li>
<li><p>timeout: The timeout after which the request should expire. The timeout is expressed in milliseconds instead of seconds to allow for realtime applications.</p></li>
</ul>
<p>The RPC response for aggregated results combines RPC messages into the result array of the final RPC response, and not only the results. This allows for the collection of error messages between success messages as shown in the example aggregate response below. Here, there is one error message next to a success message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;blinking&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32601</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Light is defect&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In addition, an optional property “zone_id” with a UUID of an omlox™ zone in the params section of a register request can be used to register for RPC calls for a particular zone. This allows RPC handlers which only work within a zone to avoid processing unnecessary requests (e.g. trying to reach tags which can only be reached when in that zone).</p>
<div class="section" id="example-message-flow">
<h3>Example Message Flow</h3>
<p>Alice registers herself for a method named “hello” and answers everybody who says hello to her with “Hello World!”.</p>
<p>Note: This example explains all intermediate steps of the message flow and thus looks longer-winded than it would be from an application perspective. From an application perspective, a client just sends a request and gets back a reply.</p>
<ol class="arabic simple">
<li><p>Alice connects to the RPC WebSocket interface of the Hub (e.g. <strong>ws://localhost:8081/v1/ws/rpc</strong> for a local instance).</p></li>
<li><p>Alice registers herself to handle a “hello” method by sending an RPC request to the Hub:</p></li>
</ol>
<p>Alice -&gt; Hub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span>
  <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
    <span class="s2">&quot;zone_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Hub responds with an ok message:</p>
<p>Hub -&gt; Alice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Another client, Bob, connects to the Hub and calls the “hello” method. Alice will get this request.</p></li>
</ol>
<p>Bob -&gt; Hub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;zone_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Bob’s message is processed by the Hub and forwarded to Alice.</p></li>
</ol>
<p>Hub -&gt; Alice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Important details for Hub implementors (not application users): Notice that Alice will see a different id in the request. This is because the Hub uses it’s own IDs and will resolve back to the original ID which the caller used (in our example, Bob used ID 2) when a response is sent by Alice to the Hub. This is a necessary step done to fulfill the requirement of the JSON-RPC specification in order to uniquely relate requests and responses, and to respond with the same ID the client used in the original request sent to the Hub.</p>
<ol class="arabic simple" start="5">
<li><p>Alice can now respond to the hello request reply with a friendly “Hello World!”.</p></li>
</ol>
<p>Alice -&gt; Hub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello World!&quot;</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10000</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>The hub processes Alice’s message, replaces the ID with the one Bob used in his request, and forwards the response to Bob:</p></li>
</ol>
<p>Hub -&gt; Bob:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello World1!&quot;</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
<p>[1] <a class="reference external" href="https://www.jsonrpc.org/specification">https://www.jsonrpc.org/specification</a></p>
</div>
</div>
<div class="section" id="changelog">
<h2>Changelog</h2>
<p><a class="reference internal" href="changelogApi.html#deep-hub-api-changelog"><span class="std std-ref">Changelog</span></a></p>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


        </div>
        
        
    </main>


      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022 Flowcate.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>