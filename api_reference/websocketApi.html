

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket API &#8212; DeepHub® 2022 R2  documentation</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/hub.css" />
    <link rel="stylesheet" type="text/css" href="../_static/root.css" />
    <link rel="stylesheet" type="text/css" href="../_static/header.css" />
    <link rel="stylesheet" type="text/css" href="../_static/index-site.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="WebSocket API" href="websocket.html" />
    <link rel="prev" title="REST API" href="restApi.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">DeepHub® 2022 R2</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../overview/index.html">
  Overview
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  DeepHub® API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../ui/index.html">
  DeepHub® UI
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../demo_access/index.html">
  Accessing Trial Instances
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation_instructions/index.html">
  Running the DeepHub® Locally
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="restApi.html">
   REST API
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="current reference internal" href="#">
   WebSocket API
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="websocket.html">
     WebSocket API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mobilezones.html">
   Mobile Zone Extension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ciscocmx.html">
   Cisco CMX Location Notification Adapter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rpc.html">
   RPC Interface
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="changelogApi.html">
   Changelog
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="changelog.html">
     Changelog
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
    <div class="d-none d-xl-block col-xl-2 bd-toc"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
        
          
          <div class="toc-item">
            
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-omlox-publish-subscribe-concept">
   General omlox™ Publish / Subscribe Concept
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#location-updates">
     location_updates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#location-updates-geojson">
     location_updates:geojson
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collision-events">
     collision_events
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fence-events">
     fence_events
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fence-events-geojson">
     fence_events:geojson
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trackable-motions">
     trackable_motions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#websocket-data-objects">
   Websocket Data Objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#subscribing-to-a-topic">
   Subscribing to a topic
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#successful-subscription-response">
     Successful subscription response
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unsubscribing">
     Unsubscribing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unsubscribe-response">
     Unsubscribe response
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-submission-without-subscription">
     Data submission without subscription
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#authorization">
   Authorization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtering-subscription-parametrization">
   Filtering &amp; Subscription Parametrization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameters-for-topic-location-updates">
     Parameters for topic location_updates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameters-for-topic-trackable-motions">
     Parameters for topic trackable_motions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameters-for-topic-fence-events">
     Parameters for topic fence_events
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameters-for-topic-collision-updates">
     Parameters for topic collision_updates
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
          </div>
          
          <div class="toc-item">
            
          </div>
          
        
    </div>


          
    

    
        
    

    <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
        
        <div>
        
  <div class="section" id="websocket-api">
<span id="deep-hub-api-websocket"></span><h1>WebSocket API</h1>
<div class="section" id="overview">
<h2>Overview</h2>
<p>This document describes the general Websocket publish / subscribe concept for connecting Location Cores and client services and to exchange messages and events over a websocket connection.</p>
</div>
<div class="section" id="general-omlox-publish-subscribe-concept">
<h2>General omlox™ Publish / Subscribe Concept</h2>
<p>Applications can subscribe and unsubscribe themselves to named topics. Data published to a topic will be received by all subscribers of that topic. All data sent to and received from the WebSocket connection is wrapped into the payload property of the wrapper object detailed in the next section. The following named topics are available:</p>
<div class="section" id="location-updates">
<h3>location_updates</h3>
<p>This topic is useful to retrieve real-time location updates, as well as sending location updates to the hub. Location data received by the hub is processed and then forwarded to all subscribers of this topic.</p>
<p>When receiving data for this topic the payload of the wrapper object contains omlox™ Location objects.</p>
</div>
<div class="section" id="location-updates-geojson">
<h3>location_updates:geojson</h3>
<p>This topic is similar to location_updates, but instead of an omlox™ Location object <a class="reference external" href="https://tools.ietf.org/html/rfc7946">GeoJson</a> feature collections are returned as payload.</p>
<p>When receiving data for this topic the payload of the wrapper object contains GeoJson feature collections.</p>
</div>
<div class="section" id="collision-events">
<h3>collision_events</h3>
<p>This topic is used to retrieve real-time collision events. The hub checks trackable movements for collisions and sends collision events when trackables: start to collide, continue to collide and end a collision.</p>
<p>When receiving data for this topic the payload of the wrapper object contains omlox™ CollisionEvent objects.</p>
</div>
<div class="section" id="fence-events">
<h3>fence_events</h3>
<p>This topic is used to inform subscribers about geofence entry and exit events. The hub implementation checks location providers and trackables for fence events and sends appropriate events to subscribers of this topic immediately for each fence entry and fence exit event.</p>
<p>When receiving data for this topic the payload of the wrapper object contains omlox™ FenceEvent objects.</p>
</div>
<div class="section" id="fence-events-geojson">
<h3>fence_events:geojson</h3>
<p>This topic is similar to fence_events, but instead of an omlox™ FenceEvent object <a class="reference external" href="https://tools.ietf.org/html/rfc7946">GeoJson</a> feature collections are returned as payload.</p>
<p>When receiving data for this topic the payload of the wrapper object contains GeoJson feature collections.</p>
</div>
<div class="section" id="trackable-motions">
<h3>trackable_motions</h3>
<p>This topic informs subscribers about movements of an omlox™ Trackable. For example, when one of the assigned omlox™ Location Providers changes its position.</p>
<p>When receiving data for this topic, the payload of the wrapper object contains omlox™ TrackableMotion objects.</p>
<p>To subscribe to a topic, the application sends a json encoded message. The server generates a response, either acknowledging a successful subscription / unsubscription or returns an error message.</p>
<p>The server also generates a subscription_id for a successful subscription. This allows an application to subscribe itself to the same topic multiple times with differing parameters and control each subscription separately. Subscriptions are otherwise automatically terminated when the websocket connection is closed.</p>
</div>
</div>
<div class="section" id="websocket-data-objects">
<h2>Websocket Data Objects</h2>
<p>Data between client and server are exchanged using a wrapper object with the following structure:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>event</p></td>
<td><p>string</p></td>
<td><p>Any of <code class="docutils literal notranslate"><span class="pre">message</span></code>, <code class="docutils literal notranslate"><span class="pre">subscribe</span></code>, <code class="docutils literal notranslate"><span class="pre">subscribed</span></code>, <code class="docutils literal notranslate"><span class="pre">unsubscribe</span></code>, <code class="docutils literal notranslate"><span class="pre">unsubscribed</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>topic</p></td>
<td><p>string</p></td>
<td><p>Topic name</p></td>
</tr>
<tr class="row-even"><td><p>subscription_id</p></td>
<td><p>int</p></td>
<td><p>The concrete topic subscription which generated the data</p></td>
</tr>
<tr class="row-odd"><td><p>payload</p></td>
<td><p>array</p></td>
<td><p>An array containing valid omlox™ data objects (or empty)</p></td>
</tr>
<tr class="row-even"><td><p>params</p></td>
<td><p>object</p></td>
<td><p>An optional object containing key-value pairs of parameters. Parameters usually match their REST API counterparts</p></td>
</tr>
</tbody>
</table>
<p>The field <code class="docutils literal notranslate"><span class="pre">event</span></code> is always required for all data exchanged between client and server. Other fields are required depending on the event type. Concrete event based data structures are detailed in the respective sections below.</p>
<p>Example data object containing an omlox™ location object as payload:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>
  <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;location_updates&quot;</span><span class="p">,</span>
  <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
  <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
          <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="mi">4</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;fdb6df62-bce8-6c23-e342-80bd5c938774&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uwb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider_id&quot;</span><span class="p">:</span> <span class="s2">&quot;77:4f:34:69:27:40&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp_generated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-09-02T22:02:24.355Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp_sent&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-09-02T22:02:24.355Z&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In case of an error the server sends a json object with event type <code class="docutils literal notranslate"><span class="pre">error</span></code> and the following data structure:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>event</p></td>
<td><p>string</p></td>
<td><p>Will be <code class="docutils literal notranslate"><span class="pre">error</span></code> for an error object</p></td>
</tr>
<tr class="row-odd"><td><p>description</p></td>
<td><p>string</p></td>
<td><p>A human readable error message</p></td>
</tr>
<tr class="row-even"><td><p>code</p></td>
<td><p>int</p></td>
<td><p>Error code</p></td>
</tr>
</tbody>
</table>
<p>Example error object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid data. The location data contains an invalid Position.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">10005</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The error code can be used by applications to discern the type of the error, e.g. for error handling and messaging on application side.</p>
<p>Possible error codes:</p>
<ul class="simple">
<li><p>10000: Event type is unknown</p></li>
<li><p>10001: Unknown topic name</p></li>
<li><p>10002: Subscription failed</p></li>
<li><p>10003: Unsubscribe failed</p></li>
<li><p>10004: Not authorized</p></li>
<li><p>10005: Invalid payload data</p></li>
</ul>
</div>
<div class="section" id="subscribing-to-a-topic">
<h2>Subscribing to a topic</h2>
<p>Subscribing to a topic opens a connection to the websocket endpoint at e.g. ws://localhost:8081/v1/ws/socket. After successfully connecting, the client sends a subscribe request message to the server.</p>
<p>The subscribe request has the following structure:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>event</p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">subscribe</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>topic</p></td>
<td><p>string</p></td>
<td><p>Name of the topic, e.g. <code class="docutils literal notranslate"><span class="pre">location_updates</span></code> or <code class="docutils literal notranslate"><span class="pre">fence_events</span></code></p></td>
</tr>
<tr class="row-even"><td><p>params</p></td>
<td><p>object</p></td>
<td><p>An optional object containing key-value pairs of parameters. Parameters usually match their REST API counterparts</p></td>
</tr>
</tbody>
</table>
<p>An example subscribe request to the location_updates topic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;location_updates&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="s2">&quot;EPSG:4326&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example subscribe request to fence events:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;fence_events&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="successful-subscription-response">
<h3>Successful subscription response</h3>
<p>The server responds to the subscribe request either with success response or an error response. On successful subscription the server responds with a <code class="docutils literal notranslate"><span class="pre">subscribed</span></code> event, a copy of the subscribed topic as well as the subscription_id for the concrete subscription.</p>
<p>It’s important to keep the provided subscription_id on the client side in case the client wants to maintain multiple subscriptions to the same topic with different parameters. A client may however simply close it’s connection, and all it’s subscriptions will be cleaned up on the server side.</p>
<p>The subscription response has the following structure:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>event</p></td>
<td><p>string</p></td>
<td><p>On success <code class="docutils literal notranslate"><span class="pre">subscribed</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>topic</p></td>
<td><p>string</p></td>
<td><p>Name of the topic</p></td>
</tr>
<tr class="row-even"><td><p>subscription_id</p></td>
<td><p>int</p></td>
<td><p>Topic subscription id</p></td>
</tr>
</tbody>
</table>
<p>Example server response for a successful subscription request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;location_updates&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="mi">123</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="unsubscribing">
<h3>Unsubscribing</h3>
<p>To unsubscribe, a client must either close the connection, or send an unsubscribe request with a concrete subscription id to the server.</p>
<p>The unsubscribe request has the following structure:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>event</p></td>
<td><p>string</p></td>
<td><p>Must be <code class="docutils literal notranslate"><span class="pre">unsubscribe</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>subscription_id</p></td>
<td><p>int</p></td>
<td><p>Topic subscription id to unsubscribe from</p></td>
</tr>
</tbody>
</table>
<p>Example unsubscribe object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;unsubscribe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="mi">123</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="unsubscribe-response">
<h3>Unsubscribe response</h3>
<p>With a successful unsubscription, the server responds with an <code class="docutils literal notranslate"><span class="pre">unsubscribed</span></code> event.</p>
<p>Unsubscribe event structure:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>event</p></td>
<td><p>string</p></td>
<td><p>Must be <code class="docutils literal notranslate"><span class="pre">unsubscribed</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>topic</p></td>
<td><p>string</p></td>
<td><p>Name of the topic</p></td>
</tr>
<tr class="row-even"><td><p>subscription_id</p></td>
<td><p>int</p></td>
<td><p>Topic subscription id from which the application was successfully unsubscribed</p></td>
</tr>
</tbody>
</table>
<p>Example unsubscribe server response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;unsubscribed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;location_updates&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="mi">123</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="data-submission-without-subscription">
<h3>Data submission without subscription</h3>
<p>A client can send / publish data to the server directly over the websocket connection without a subscription. For example, a client can send raw location data to the location_updates topic; the server processes the data in the same way as the /providers/locations API and then publishes the processed location data to subscribers of the location_updates topic. A data object sent by the client must have the event type <code class="docutils literal notranslate"><span class="pre">message</span></code> and use one of the available writeable topics.</p>
<p>The message data has the following structure:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>event</p></td>
<td><p>string</p></td>
<td><p>Must be <code class="docutils literal notranslate"><span class="pre">message</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>topic</p></td>
<td><p>string</p></td>
<td><p>Topic name (location_updates or fence_events)</p></td>
</tr>
<tr class="row-even"><td><p>payload</p></td>
<td><p>array</p></td>
<td><p>An array containing valid omlox™ data objects (or empty)</p></td>
</tr>
</tbody>
</table>
<p>Example message object containing raw location data for the location_updates topic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>
  <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;location_updates&quot;</span><span class="p">,</span>
  <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
          <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="mi">4</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;fdb6df62-bce8-6c23-e342-80bd5c938774&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uwb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider_id&quot;</span><span class="p">:</span> <span class="s2">&quot;77:4f:34:69:27:40&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp_generated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-09-02T22:02:24.355Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp_sent&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-09-02T22:02:24.355Z&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="authorization">
<h2>Authorization</h2>
<p>When authorization is enabled, each event must contain a JWT token in the params section, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;fence_events&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span><span class="s2">&quot;eyJhbG...&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-subscription-parametrization">
<h2>Filtering &amp; Subscription Parametrization</h2>
<p>The publish / subscribe API allows to filter and transform data feeds by setting parameters as key / value pairs to the params section of a subscription request. The following example shows a subscription request to trackable motions with location data projected to UTM 32 (EPSG:32632) and filtering for a certain trackable id:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;trackable_motions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="s2">&quot;EPSG:32632&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;0b680db2-b39b-45be-be77-40d7d2296cb4&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note: There can be any number of active subscriptions made by the same client to a topic. For example, it’s possible to make two distinct subscriptions to the location_updates topic, where each subscription may filter for example for a different location provider. Subscribing to the same topic with the same parameters twice will however result in a subscription error, as is to be expected.</p>
<p>The following parameters are available for the respective WebSocket topics.</p>
<div class="section" id="parameters-for-topic-location-updates">
<h3>Parameters for topic location_updates</h3>
<table class="table">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>param</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>provider_id</p></td>
<td><p>Filter events matching the given provider ID</p></td>
</tr>
<tr class="row-odd"><td><p>source</p></td>
<td><p>Filter events by source (e.g., zone)</p></td>
</tr>
<tr class="row-even"><td><p>provider_type</p></td>
<td><p>Filter by omlox provider type (e.g., uwb, wifi, rfid)</p></td>
</tr>
<tr class="row-odd"><td><p>associated</p></td>
<td><p>Filter events which are currently associated to an infrastructure (e.g., relevant for wifi systems)</p></td>
</tr>
<tr class="row-even"><td><p>accuracy</p></td>
<td><p>Filter data where accuracy is better than or equal to the value provided</p></td>
</tr>
<tr class="row-odd"><td><p>floor</p></td>
<td><p>Filter data matching the given floor level</p></td>
</tr>
<tr class="row-even"><td><p>crs</p></td>
<td><p>Project location data to the given crs. Any crs supported by omlox can be set (e.g., local, EPSG:32632)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="parameters-for-topic-trackable-motions">
<h3>Parameters for topic trackable_motions</h3>
<table class="table">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>param</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>Filter events matching the given trackable ID</p></td>
</tr>
<tr class="row-odd"><td><p>provider_id</p></td>
<td><p>Filter events matching the provider ID</p></td>
</tr>
<tr class="row-even"><td><p>name</p></td>
<td><p>Filter events matching the trackable name</p></td>
</tr>
<tr class="row-odd"><td><p>floor</p></td>
<td><p>Filter events matching given floor level</p></td>
</tr>
<tr class="row-even"><td><p>crs</p></td>
<td><p>Project location data to the given crs. Any crs supported by omlox can be set (e.g., local, EPSG:32632)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="parameters-for-topic-fence-events">
<h3>Parameters for topic fence_events</h3>
<table class="table">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>param</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fence_id</p></td>
<td><p>Filter events matching the given fence ID</p></td>
</tr>
<tr class="row-odd"><td><p>foreign_id</p></td>
<td><p>Filter events matching the given foreign ID</p></td>
</tr>
<tr class="row-even"><td><p>provider_id</p></td>
<td><p>Filter events matching the provider ID which caused the fence event</p></td>
</tr>
<tr class="row-odd"><td><p>trackable_id</p></td>
<td><p>Filter events matching the trackable ID which was involved in the fence event</p></td>
</tr>
<tr class="row-even"><td><p>event_type</p></td>
<td><p>Filter for fence entry (region_entry) or fence exit (region_exit) events</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="parameters-for-topic-collision-updates">
<h3>Parameters for topic collision_updates</h3>
<table class="table">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>param</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>collision_id_1</p></td>
<td><p>Filter events where one item of the collision pair matches given id (e.g., trackable ID involved in the collision)</p></td>
</tr>
<tr class="row-odd"><td><p>collision_id_2</p></td>
<td><p>Same as collision_id_1. Note: When both collision_id_1 and collision_id_2 are set events will effectively be filtered for collisions between these two trackables</p></td>
</tr>
<tr class="row-even"><td><p>collision_type</p></td>
<td><p>Filter events by collision type. One of collision_start, colliding, collision_end</p></td>
</tr>
</tbody>
</table>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>


        </div>
        
        
    </main>


      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022 Flowcate.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>